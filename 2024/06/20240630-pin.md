---
layout: post
title: "SecureBootをOFFにしたらWindows11のPIN認証が失敗するようになった"
tags:
  - linux
date: 2024/06/30
---

[前回](20240629-pi.md)、Raspberry OSでパスワード認証の設定を変更するためにDebian12 Live DVDを使った。
そのとき、ThinkPadがSecureBootの設定をONにしているため起動できなかったので、一時的にOFFにした。

Live DVDの用が済んだので Secure BootをONに戻して Windows11を起動しようとした。
が、いつものPIN入力がうまくいかない。
間違ったPINを入力したエラーではなく、PINを確認するシステムがうまくいっていないような感じのエラーだ。

PIN入力は失敗し続けるとPINを再入力するような動作になる。
今回もそういう動作をし始めたのだが、インターネットに接続していないというエラーになって進めない。
これは、私が[wfc](https://www.binisoft.org/wfc)をインストールして初見でネットワークに接続するアプリを拒絶するようになっているためだと思う。
ログイン済みならばwfcが接続するかどうかのダイアログを表示するのだが、ログイン画面はちょっと特殊なのでそういうダイアログは表示されない。
ど、どうしたらよいのだ？？

----

幸いなことにうちには2台のWindows PCがあるので、もう1台の方で回復ディスクを作ることができた。
以前はPC1台ごとに回復ディスクを作っていたのだが、どうも同じ内容のように見える。それに、Windows10時代の回復ディスクでも使うことができたので、本体は起動ディスクのパーティションに入っているのかもしれない。

回復ディスクを使うと、コマンドプロンプトが使えるようになる。  
最初に試みたのは、wfcのアンインストールだった。しかしこれは失敗した。これは回復ディスクで起動しただけでオリジナルのディスクから起動したわけではないので、情報が分からないからだろう。  
同じ理由で、PINが必要ないローカルアカウントの作成もできなかった。  
ファイアウォールを無効にすればインターネットに接続できるだろうと考えたが、うん、これも同じだ。

そういうときに見つけたのがこちら。

[Windows 11でログオン画面でPINが使えなくなったパスワードロックのリカバリー: PATHpilotのブログ](http://www.pathpilot.jp/blog/2024/04/post-3fc2c8.html)

たぶんアクセシビリティの設定関連である`utilman.exe`を`cmd.exe`に置き換え、ログイン画面からコマンドプロンプトを立ち上げようという作戦だ。  
そして私の場合は、このやり方でコマンドプロンプトが起動した。  
そのコマンドプロンプトからは`netsh advfirewall`が使えたのでファイアウォールを無効化した。

[Windows 11 - ファイアウォールを無効にする方法 - PC設定のカルマ](https://pc-karuma.net/how-to-disable-firewall-on-windows-11/#%E3%80%8C%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%97%E3%83%AD%E3%83%B3%E3%83%97%E3%83%88%E3%80%8D%E3%81%A7%E7%84%A1%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88)

こうやってからPINの再設定をすると、インターネットに接続できてログインできた。  
指紋認証の設定なんかも使えなくなっていたので再登録したが、そのくらいで元通りに使うことができた(たぶん)。

----

そのあと、確認のために Live DVD で Debian12 を立ち上げたのだが、Secure BootをONにしたままなのに使えるじゃないか。。。  
なんだろう、昨日なにか見逃してしまったのか？？ 写真も何も残っていないのでさっぱりわからない。。。

とりあえず、もう一度同じ目に会わないようにするためローカルアカウントを追加した。
Windows11 Proのマシンはローカルアカウント設定にしているのだが、Homeの方はデフォルトでそれができなくなったので苦肉の策である。
MicrosoftアカウントでWindowsのアカウントを作らないといけない場合、ディレクトリ名などを強制的に決められるので嫌なのよね。
