---
layout: post
title: "docker: orphan"
tags:
  - other
date: "2026/01/16"
---

実装中なので、ブロックチェーン側の docker compose とアプリ側の docker compose を別々に起動している。  
最初はアプリ側のログを流すために `docker compose up` だけしていたのだが、そろそろログが要らなくなったので `-d` 付きで実行したところ警告が出力されていることに気づいた。  
orphanなコンテナが見つかったとかなんとか。  
検索すれば対策はいろいろ出てくるのだが、そもそもなんなのかが気になった。

* [COMPOSE_REMOVE_ORPHANS](https://docs.docker.com/compose/how-tos/environment-variables/envvars/#compose_remove_orphans)
  * When enabled, Compose automatically removes orphaned containers when updating a service or stack.
  * デフォルトは disabled
* [COMPOSE_IGNORE_ORPHANS](https://docs.docker.com/compose/how-tos/environment-variables/envvars/#compose_ignore_orphans)
  * When enabled, Compose doesn't try to detect orphaned containers for the project.
  * デフォルトは disabled

"orphan container" は `COMPOSE_REMOVE_ORPHANS` の文章にあるこちらだろう。

>  Orphaned containers are those that were created by a previous configuration but are no longer defined in the current compose.yaml file.

前回の `compose.yaml` にあって作られたけど今回の `compose.yaml` に載っていないコンテナのこと、でよいのかな。  
意図的に `-f` で別の `compose.yaml` を指定する場合も該当するのだろう。
対策で「プロジェクト名をつける」が有効なのは、何も指定しないと同じプロジェクト名が付けられ、そのプロジェクトについて orphan チェックをするからか？  
無視する方向でも良いかもしれないが、同じプロジェクトについてはチェックしてもらった方が良いので、私もプロジェクト名をつけることにした。

## No services to build

もう1つ警告が出る。  
"No services to build" で、単にビルドするサービスがないというだけのものだ。  
WARN で出すほどのものか・・・？

2025年年末に issue が出ていて、Pull Request も早々にマージされたのでそのうち出力されなくなるだろう。

* [\[BUG\] Unhelpful warning "No services to build" with `docker compose up` · Issue #13484 · docker/compose](https://github.com/docker/compose/issues/13484)
