---
layout: post
title: "wsl: WezTerm"
tags:
  - windows
  - wsl
date: "2026/01/24"
---

以前、WSLのコンソールログを取るのにTeraTermのような自動保存ができるものがないか調べたことがある。

* [wsl: コンソールログを取りたい - hiro99ma blog](https://blog.hirokuma.work/2025/06/20250612-wsl.html)

そういうのは気にせず、標準以外のターミナルを使いたくなった。
タブの色が見分けづらくて。。。と外観を切り替えると「ライト」なら今のままでもいいかという気になってしまった。

![image](images/20260124a-1.png)

全部コピーするのに Ctrl+Shift+A, Ctrl+Shift+C とするときに間違えて Ctrl+C になってプロセスを終了させてしまうことがあったし、
タブの選択をマウスでするときに間違って閉じるボタンをクリックしてしまったりしたし、思い切ってやってしまおう。

## WezTerm

* [WezTerm - Wez's Terminal Emulator](https://wezterm.org/)

`.wezterm.lua` への設定でなんでもかんでもやってしまう。
動的に反映されて、設定が間違っていると保存したときにエラーのウィンドウが出てくる。
別のエラーになると内容は更新されるが(たぶん)、エラーが修正されてもウィンドウは自動では閉じなかった。
なのでウィンドウを閉じてから保存したほうがわかりよい。  
Ctrl+Sfhit+L でデバッグログに切り替わるのでそっちも見ることがあるかも。

* デフォルトで WSL2
* 120x30
* フォントは'UDEV Gothic HSJPDOC'
* Ctrl+Shift+E : タブ名をつける
  * タブ名に "red" や "green:hogefuga" などとつけると赤・緑・青系の色にする
* Ctrl+Shift+A : 全バッファをクリップボードにコピー
* Ctrl+Shift+V : クリップボードから貼り付け
* 右クリック : クリップボードから貼り付け

```lua
local wezterm = require 'wezterm'
local config = wezterm.config_builder()

config.default_domain = 'WSL:Ubuntu'
config.initial_cols = 120
config.initial_rows = 30

config.font_size = 12
config.font = wezterm.font 'UDEV Gothic HSJPDOC'
config.color_scheme = 'AdventureTime'

-- タブの見た目を動的に制御する("red", "green:name"など)
wezterm.on('format-tab-title', function(tab, tabs, panes, config, hover, max_width)
    local title = tab.tab_title
    
    if title == "" then
      title = "ubuntu"
    end
    local part1, part2 = title:match("([^:]+):?(.*)")
    part1 = part1:lower()

    local foreground
    local background
    if part1 == "r" or part1 == "red" then
        if tab.is_active then
          foreground = '#ffffff'
          background = '#ff4040'
        else
          foreground = '#808080'
          background = '#ff8080'
        end
    elseif part1 == "g" or part1 == "green" then
        if tab.is_active then
          foreground = '#000000'
          background = '#80ff80'
        else
          foreground = '#808080'
          background = '#c0ffc0'
        end
    elseif part1 == "b" or part1 == "blue" then
        if tab.is_active then
          foreground = '#000000'
          background = '#8080ff'
        else
          foreground = '#808080'
          background = '#c0c0ff'
        end
    else
      if tab.is_active then
        foreground = '#ffffff'
        background = '#606060'
      else
        foreground = '#808080'
        background = '#202020'
      end
    end
    return {
      { Foreground = { Color = foreground } },
      { Background = { Color = background } },
      { Text = title },
    }
end)

config.mouse_bindings = {
  -- 右クリックで貼り付け
  {
    event = { Down = { streak = 1, button = 'Right' } },
    mods = 'NONE',
    action = wezterm.action.PasteFrom 'Clipboard',
  },
}

config.keys = {
  {
    -- ペースト
    key = 'V',
    mods = 'CTRL|SHIFT',
    action = wezterm.action.PasteFrom 'Clipboard',
  },
  {
    -- バッファ全部をクリップボードにコピー
    key = 'A',
    mods = 'CTRL|SHIFT',
    action = wezterm.action_callback(function(window, pane)
      local dims = pane:get_dimensions()
      local scrollback_top = dims.scrollback_top
      local scrollback_rows = dims.scrollback_rows

      local text = pane:get_text_from_region(
        0,                      -- col 0
        scrollback_top,         -- scrollback 行のトップ
        0,                      -- col 0
        scrollback_top + scrollback_rows -- 最下行
      )

      window:copy_to_clipboard(text)
    end),
  },
  {
    -- タブ名変更
    key = 'E',
    mods = 'CTRL|SHIFT',
    action = wezterm.action.PromptInputLine {
      description = 'Enter new name for tab',
      action = wezterm.action_callback(function(window, pane, line)
        if line then
          window:active_tab():set_title(line)
        end
      end),
    },
  },
}

return config
```
