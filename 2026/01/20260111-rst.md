---
layout: post
title: "rust: 関数ポインタ"
tags:
  - rust
date: "2026/01/12"
---

本を読んで、Rust にも関数ポインタがあることを知った。  
シグネイチャが型になるのは他の言語とだいたい同じかな。  
比較はあまり使わないように思ったが、わざわざ関数が用意してあるので使い所があるのだろう。

この例の `op` は型を指定しているので `fn_addr_eq()` に何もせず与えられるが、直接 `sum` を代入した場合はダメらしい。
理由は[本](https://www.oreilly.co.jp/books/9784814400942/)に載っていたが、気になる人は買って読んでみるとよかろう。

```rust
use std::ptr::fn_addr_eq;

fn sum(x: i32, y:i32) -> i32 {
    x + y
}

fn main() {
    let op: fn(i32, i32) -> i32 = sum;
    assert!(op(1, 2) == 3);

    let op1 = op;
    let op2 = op;
    // assert!(op1 == op2);
    assert!(fn_addr_eq(op1, op2));

    let op1 = sum;
    let op2 = sum;
    assert!(fn_addr_eq(op1 as fn(i32, i32) -> i32, op2 as fn(i32, i32) -> i32));
}
```
