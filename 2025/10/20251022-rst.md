---
layout: post
title: "rust: bdk_walletの使い方 (1)"
tags:
  - rust
  - bitcoin
date: "2025/10/21"
---

BDK を使ってトランザクションを作るところまでできたので、整理を兼ねて使い方をまとめよう。  
そのうち Bitcoin調査のページにまとめたいものだ。

## サンプルコード

作ったのはこちら。

* [hirokuma/bdk-example at f157255e5c7f799608b90d3cdc2efb0be502dacc](https://github.com/hirokuma/bdk-example/tree/f157255e5c7f799608b90d3cdc2efb0be502dacc)

## 使用する BDK

`bdk_wallet` v2.2.0

* [bdk_wallet - Rust](https://docs.rs/bdk_wallet/2.2.0/bdk_wallet/index.html)
* [Release Release wallet-2.2.0 · bitcoindevkit/bdk_wallet](https://github.com/bitcoindevkit/bdk_wallet/releases/tag/wallet-2.2.0)

`bdk_bitcoind_rpc` v0.22.0

* [bdk_bitcoind_rpc - Rust](https://docs.rs/bdk_bitcoind_rpc/0.22.0/bdk_bitcoind_rpc/index.html)
* [bdk/crates/bitcoind_rpc at master · bitcoindevkit/bdk](https://github.com/bitcoindevkit/bdk/tree/126ebda443baebe4886a16e397d76270ac7c21d7/crates/bitcoind_rpc)

[Cargo.toml](https://github.com/hirokuma/bdk-example/blob/f157255e5c7f799608b90d3cdc2efb0be502dacc/Cargo.toml) はこうなっている。

```toml
[dependencies]
bdk_wallet = { version = "2.2.0", features = ["rusqlite"] }
bdk_bitcoind_rpc = "0.22.0"
hex = "0.4.3"
anyhow = "1.0.100"
serde = { version = "1.0.228", features = ["derive"] }
clap = { version = "4.3.10", features = ["derive"] }
toml = "0.9.8"
```

## wallet作成

今回は P2TR の単独鍵ウォレットを作っている。  
対象のネットワークは Bitcoin regtest としている。

* [bdk-example/src/segwit/wallet.rs at main · hirokuma/bdk-example](https://github.com/hirokuma/bdk-example/blob/main/src/segwit/wallet.rs)

最初に書かないといけないことだが、このウォレット実装は非常に雑である。  
特に秘密鍵に当たるデータをそのままテキストファイルに保存しているのはよろしくない。

### 構造体

`Connection` を持っているのは `wallet.persist()` のためである。

```rust
pub struct MyWallet {
    pub wallet: PersistedWallet<Connection>,
    conn: Connection,
}
```


