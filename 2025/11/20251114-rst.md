---
layout: post
title: "rust: 縦棒2本はなんなの？"
tags:
  - rust
date: "2025/11/14"
---

`anyhow::Context` の [with_context()](https://docs.rs/anyhow/latest/anyhow/trait.Context.html#example) は `.with_context(|| "abc")` のように使うし、
[.map()](https://doc.rust-lang.org/std/result/enum.Result.html#method.map) では `.map(|i| i * 2)` のように使う。  
この縦棒2本は何なんだ。

## 縦棒の呼び名

C言語ではビット演算や論理演算で出てくるあれだが、そもそも呼び名を知らないことに気付いた。  
vertical bar とか vertical line とからしい。

* [バーティカルバー - Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%90%E3%83%BC%E3%83%86%E3%82%A3%E3%82%AB%E3%83%AB%E3%83%90%E3%83%BC)
* [バーティカルバー（｜ / 縦線）とは - IT用語辞典 e-Words](https://e-words.jp/w/%E3%83%90%E3%83%BC%E3%83%86%E3%82%A3%E3%82%AB%E3%83%AB%E3%83%90%E3%83%BC.html)

## クロージャー

Rust の表にあった。  
演算子としての意味だと C言語と同じだが、そうではない使い方をした場合はクロージャーになる。  

* [Non-operator Symbols](https://doc.rust-lang.org/book/appendix-02-operators.html#non-operator-symbols)

無名関数などと一緒に説明があってどれがどれかよくわからなくなるあれだ。  
縦棒は仮引数で、外側の値を内側に持ってくるときに「これらを使いますよー」という意味になる。  
クロージャー自体は `|仮引数...| {中身}` 

* [クロージャ：環境をキャプチャできる匿名関数 - The Rust Programming Language 日本語版](https://doc.rust-jp.rs/book-ja/ch13-01-closures.html)
  * [クロージャでリファクタリングして、コードを保存する](https://doc.rust-jp.rs/book-ja/ch13-01-closures.html#%E3%82%AF%E3%83%AD%E3%83%BC%E3%82%B8%E3%83%A3%E3%81%A7%E3%83%AA%E3%83%95%E3%82%A1%E3%82%AF%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%97%E3%81%A6%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B)

`.with_context()` は仮引数にしたいものがないけどクロージャーの書き方として `||` の部分が必要だからあるというだけだ。
仮引数が無い関数が `my_func()` となるのと同じことだ。

他の言語で `|～|` を使っているので採用されたそうだ。

### 仮引数が必要なことも

単にクロージャーを実装するだけでなく、こういうクロージャーがいるという指定がされる場合もある。  
それでも引数にするものがないなら `|_|` などと書いてごまかすようだ。
