# btc: Output Descriptors (3)

_2025/03/01_

## はじめに

もう少し Output Descriptors を扱おう。

## libwally-core

多少は Output Descriptors の知識を得られたので、何か作ってみよう。  
C言語で libwally-core の API を使って実装する。

[Descriptor Functions](https://wally.readthedocs.io/en/release_1.3.1/descriptor.html) はある。  
ためしに BDK のサンプルにあった [Descriptors](https://bitcoindevkit.github.io/book-of-bdk/cookbook/quickstart/#descriptors) のデータを与えてみたのだが `wally_descriptor_parse()` でエラーになった。

libwally-core の commit 履歴を見たところ、descriptor で `tr()` をサポートしたのが [2025年1月](https://github.com/ElementsProject/libwally-core/commit/dc8165eaee3fb1a3d61e9163d891b04b10a7a971) で v1.3.1 よりも後だ。
ならばと 2025年3月1日時点の `master` ブランチをビルドしたところコンパイルエラーになった。
Elements 対応で追加されたコードがマクロで囲まれていないためか私の Elements 無しビルドだとエラーになるようなのだ。

まだラベルなどもないので descriptor に関する commit がある程度落ち着いたような感じがするところで checkout すると成功した。

* [commit](https://github.com/hirokuma/c-descriptor/tree/31e9925cb2dfa2b47518cc8907ac1801a73ed43d)

README に書いているが、中途半端なところをチェックアウトした。
まあ、タグも何もないから仕方ないのだが。  
libsecp256k1 はシステムにインストールしたものを使っているが、
これは MuSig2 のサンプルを作ったときに v1.3.1 の submodule になっている libsecp256k1-zkp では MuSig2 が有効になっていなかったためだ。  
今回の目的ではどちらでもよいと思う。

実装はまだ `wally_descriptor_parse()` を呼び出しているだけだ。  
サポートしていないとこれでエラーになるのである。

## おわりに

BDK のサンプルコードと同じことができれば良いな。
