# btc: bitcoindのblocksを別ディレクトリにしたい

_2025/04/02_

## はじめに

Raspberry Pi でフルノードを立てている。  
1TB の HDD が空いていたので遅くてもよいやと pruned にしていた。  
electrs を立ち上げてみたくなったのだが pruned ではダメだという。
まあ、そりゃそうだ。

pruned から元に戻すには最初から IBD のやり直しになる。  
既に 2週間くらいやり続けているのだが後10日くらいはかかりそうだ。  
フルノードが収まるほどの SSD は空いていないので購入まで考えていたのだが、
特にフルノードを立てて何かしたいという程でもないので、なんだかもったいない。

340GB の SSD は空いていたのでデータを分割できるなら使えるかも、と思った。

## 現状

txindex は指定していないので、これは以前のファイルが残っているだけだろう。  
compact filter は LND を立てていたこともあってセットしているのだが、
LND 以外で使われているのを見たことがないので外してもよいかと思っている。

```console
$ du -h
12G     ./chainstate
201M    ./blocks/index
685G    ./blocks
11G     ./indexes/blockfilter
31G     ./indexes/txindex
42G     ./indexes
738G    .
```

## 分割案

bitcoind の機能として、データをサイズごとにディレクトリに分けるようなものはない。  
ChatGPT氏に案を訊くと、シンボリックリンクにしたら？という提案をされた。
LVM も提案されたが、私はやったことないし、古いデータだけ HDD に残したいので
手動でやった方が良い気がしている。

ファイルは1万個近くあるが、シンボリックリンクはワイルドカードで作ることもできそうなのでそこまで負担にはならないだろう。

* [ワイルドカードでマッチした全ファイルに対するシンボリックリンクを作成する方法 - でぶぬる日記](https://aquarla.hatenadiary.org/entry/20121206/1354784935)

メインのディスクを 340GB の SSD にして、
今ある blocks はファイルをシンボリックリンクに、
chainstate と indexes はディレクトリをシンボリックリンクにし、
それ以外は SSD に移動させるとよさそうだ。

* [Data directory layout](https://github.com/bitcoin/bitcoin/blob/v28.1/doc/files.md#data-directory-layout)

bitcoind の起動時にデータをチェックされるので HDD にあるファイルが多いと時間はかかるのだが
それはもう仕方あるまい。
どのくらいかかるかは記憶にない。1日以上かかることはないと思いたい。

## やってみよう

やるにしても気力がいるので、そのとき追記しよう。
