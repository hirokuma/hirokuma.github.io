---
layout: post
title: "rust: rust-bitcoin と BDK (5)"
tags:
  - rust
  - bitcoin
date: "2025/09/23"
---

rust-bitcoin のサンプルは動いたので、次は [BDK](https://github.com/bitcoindevkit) を見てみよう。

ライブラリの数が多い。
bdk リポジトリに複数のライブラリがあるのだが、それでも多い。  
必要に応じて使えばよいものだと思うので、何かサンプルを見てみる。

* [Getting Started - The Book of BDK](https://bookofbdk.com/getting-started/getting-started/)

手始めに見るにはよさそうなところだったが、書いている時点(2025/09/23)で `bdk_wallet@1.0.0` を add しているものの、
今の最新 bdk_wallet は [v2.1.0](https://github.com/bitcoindevkit/bdk_wallet/releases/tag/wallet-2.1.0) だ。  
[book のリポジトリ](https://github.com/bitcoindevkit/book-of-bdk/tree/3a0832dde2e130fd048e8f3af7534812aaa865f9/docs/getting-started) を見たが、こちらも v1.0.0 なのでサイトが更新されていないだけというわけではないようだ。  
メジャーバージョンが変わった [v2.0.0](https://github.com/bitcoindevkit/bdk_wallet/releases/tag/wallet-2.0.0) を見るとそこまで数は多くなさそうだし、"breaking change" のような言葉も出てきていない。
案外、[Starter Example - The Book of BDK](https://bookofbdk.com/cookbook/starter-example/) は動くのかもしれない。

まあ、仕事じゃないので当たって砕けても問題ないからやっておこう。

## Starter Example

* [Starter Example - The Book of BDK](https://bookofbdk.com/cookbook/starter-example/)

[`cargo init`](https://doc.rust-lang.org/cargo/commands/cargo-init.html) でやってるけど、[`cargo new`](https://doc.rust-lang.org/cargo/commands/cargo-new.html) との違いは何だ？  
同じように `src/main.rs` ができたことからすると、存在しないディレクトリ名を指定すると新規作成して `cargo init` すると `cargo new` と同じ挙動になるのかも。  
(何も無いディレクトリでそれぞれ `cargo new aaa` と `cargo init aaa` を実行して WinMerge で比較したが同一だった。)

```bash
cargo init bdk-starter-example
cd bdk-starter-example
```

Cargo.toml はバージョンだけ新しくした。

```toml
[dependencies]
bdk_wallet = { version = "2.1.0", features = ["rusqlite"] }
bdk_esplora = { version = "0.22.1", features = ["blocking"] }
```

動いた。  
`use` や const 値は書いていなかったので vscode(の Extensions) に解決してもらった。  
困ったのは `STOP_GAP` などを「数値だから `u32` でよかろう」としていたので `full_scan()` がエラーになったところくらいだ。

* [hirokuma/bdk-example at starter-example](https://github.com/hirokuma/bdk-example/tree/starter-example)

```log
Syncing wallet...
Wallet balance: 150608 sat
```

ほとんど記憶になかったが、同じようなことを半年前くらいにやっていたようだ。
BDK Cookbook の Quick Start Example というページをやっていたようだが、ページの構成が変わったのかリンク先がよくわからなかった。
ウォレットの descriptor 文字列が同じだから、だいたい同じようなものだろう。

* [btc: BDK で Rust を扱ってみよう - hiro99ma blog](https://blog.hirokuma.work/2025/03/20250304-btc.html)

balance 表示に続けてアドレス情報などを出力させたのが違うくらいか。  
日記の最後に「Rust の勉強にはならなかった」と書いているので、自分の力不足を感じたとかなんとかで途中で止めたのだろう。

[Transaction Builder](https://bookofbdk.com/cookbook/transactions/transaction-builder/) でトランザクションを作ることができそうなので、次は rust-bitcoin のサンプルと同じことをやってみよう。
