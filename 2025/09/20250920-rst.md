---
layout: post
title: "rust: rust-bitcoin と BDK (4)"
tags:
  - rust
  - bitcoin
date: "2025/09/20"
---

前回の続き。

* [Introduction - Rust Bitcoin Cookbook](https://rust-bitcoin.org/book/intro.html)

## mod と use

少し書き直して、segwit v0 と v1 を同じプロジェクトにまとめた。  
workspace など使うとよいのかもしれないが、よくわからんのでまずは binary としてまとめてみた。  
単体テストを考慮すると中身を library に移動させた方が良いんだったか。

* [commit](https://github.com/hirokuma/rust-bitcoin-sample/tree/ce7d546317f5d9841a04fc05a1e0caa58a01402b)

まだ `mod` と `use` の使い方が理解できていない。。  
いくつか共通で使用できる項目があったので `common.rs` に移動させ、あとは v0 と v1 で使おうとした。  
そうすると、使う方のファイルでは `use super::common::XXX;` のように書かないと使えなかった。

同じディレクトリの中にあるから `super::` とかいらんやろうと思ったが、
ファイル名＝モジュール名になるので、カレントファイルの中からは 1つ上に上がらないと使えない。  
もしカレントファイルがデフォルトで 1つ上のモジュールと同じになると、それはそれでおかしくなる。
同じファイル内に `mod` で書いたときにいちいち自分のモジュール名を書かないと使えないとか。

あとは、基本的に `mod` も `use` も書かないといけないというところか。  
`cargo add` していると `use` だけで使えるので `mod` は定義だけのように感じていたが、[外部パッケージ](https://doc.rust-jp.rs/book-ja/ch07-04-bringing-paths-into-scope-with-the-use-keyword.html#%E5%A4%96%E9%83%A8%E3%81%AE%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%BF%E3%81%86) は別ルールなだけだろう。  
こういうのが、まだ判断が付かないところだ。
